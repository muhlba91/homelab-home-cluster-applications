---
domain: &domain emqx.dev.iot.internal.muehlbachler.io
mqttDomain: &mqtt_domain mqtt.dev.iot.internal.muehlbachler.io

service:
  annotations:
    metallb.universe.tf/loadBalancerIPs: "10.0.220.20,2a01:aea0:dd3:25a:f000:21:20"

emqx:
  fullnameOverride: emqx

  envFromSecret: home-assistant-emqx

  replicaCount: 1

  ingress:
    dashboard:
      enabled: true
      annotations:
        cert-manager.io/cluster-issuer: cluster-issuer-internal-muehlbachler-io
        external-dns.alpha.kubernetes.io/provider: internal
        traefik.ingress.kubernetes.io/router.tls: "true"
      hosts:
        - *domain
      tls:
        - secretName: home-assistant-emqx-tls-cert
          hosts:
            - *domain

  persistence:
    enabled: true
    storageClassName: longhorn
    accessMode: ReadWriteOnce
    size: 128Mi

  ssl:
    enabled: true
    dnsnames:
      - *mqtt_domain
    issuer:
      name: cluster-issuer-internal-muehlbachler-io
      kind: ClusterIssuer

  resources:
    requests:
      cpu: 30m
      memory: 296Mi
    limits:
      cpu: 300m
      memory: 512Mi
