---
domain: &domain minio.dev.internal.muehlbachler.io
consoleDomain: &console_domain console.minio.dev.internal.muehlbachler.io

ingressAnnotations: &ingress_annotations
  cert-manager.io/cluster-issuer: cluster-issuer-internal-muehlbachler-io
  external-dns.alpha.kubernetes.io/provider: internal
  traefik.ingress.kubernetes.io/router.tls: "true"

minio:
  image:
    repository: quay.io/minio/minio
    tag: RELEASE.2023-01-20T02-05-44Z

  mode: standalone
  replicas: 1

  existingSecret: minio-root-user

  securityContext:
    enabled: false

  persistence:
    storageClass: nfs-storage
    size: 1Gi

  ingress:
    enabled: true
    annotations: *ingress_annotations
    hosts:
      - *domain
    tls:
      - secretName: minio-tls-cert
        hosts:
          - *domain

  consoleIngress:
    enabled: true
    annotations: *ingress_annotations
    hosts:
      - *console_domain
    tls:
      - secretName: minio-console-tls-cert
        hosts:
          - *console_domain

  policies:
    - name: buildkite-agent
      statements:
        - resources:
            - "arn:aws:s3:::buildkite-agent-cache-*"
            - "arn:aws:s3:::buildkite-agent-cache-*/*"
          actions:
            - "s3:*"
  users:
    - accessKey: buildkite-agent
      existingSecret: buildkite-agent-user
      existingSecretKey: secret-access-key
      policy: buildkite-agent
  buckets:
    - name: buildkite-agent-cache-dev
      policy: none
      purge: false
      versioning: false
      objectlocking: false
  postJob:
    annotations:
      argocd.argoproj.io/hook: PostSync

  resources:
    requests:
      cpu: 20m
      memory: 296Mi
    limits:
      cpu: 100m
      memory: 512Mi
