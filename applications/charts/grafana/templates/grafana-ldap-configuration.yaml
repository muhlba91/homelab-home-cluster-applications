---
apiVersion: v1
kind: Secret
type: Opaque
metadata:
  name: grafana-ldap-configuration
stringData:
  ldap-toml: |
    verbose_logging = false

    [[servers]]
    host = "{{ .Values.ldap.host }}"
    port = 636
    use_ssl = true
    start_tls = false
    ssl_skip_verify = false

    bind_dn = "{{ .Values.ldap.bindDn }}"
    bind_password = "${LDAP_BIND_PASSWORD}"

    search_filter = "(uid=%s)"
    search_base_dns = ["{{ .Values.ldap.baseDn }}"]

    # group_search_filter = "(&(objectClass=posixGroup)(memberUid=%s))"
    # group_search_filter_user_attribute = "distinguishedName"
    # group_search_base_dns = ["ou=groups,dc=grafana,dc=org"]

    [servers.attributes]
    member_of = "memberOf"
    name = "givenName"
    surname = "sn"
    username = "uid"
    email =  "mail"

    [[servers.group_mappings]]
    group_dn = "{{ .Values.ldap.groups.admin.dn }}"
    org_role = "Admin"

    [[servers.group_mappings]]
    group_dn = "*"
    org_role = "Viewer"
